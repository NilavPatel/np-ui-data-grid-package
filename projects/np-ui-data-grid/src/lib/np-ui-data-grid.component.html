<div class="np-grid-component" 
    [style.max-height.px]="height - 2" 
    [style.max-width.px]="width - 2" 
    [id]="tableId"
    [ngClass]="{'locked': _showLoader}">
    <div *ngIf="_showLoader" class="np-loader"></div>
    <div *ngIf="title && title.length > 0" class="np-grid-title">{{title}}</div>
    <div class="np-toolbar" *ngIf="showToolBar">
        <div class="np-toolbar-item" *ngIf="showColumnChooser">
            <button type="button" title="Column chooser" class="np-icon-button column-chooser" *ngIf="showColumnChooser" (click)="_toggleColumnChooser()">
                <svg class="np-icon-lg" viewBox="0 0 24 24">
                    <path fill="none" d="M0 0h24v24H0V0z" />
                    <path fill="currentcolor" d="M4 5v13h17V5H4zm10 2v9h-3V7h3zM6 7h3v9H6V7zm13 9h-3V7h3v9z"/>
                </svg>
            </button>
            <div class="np-column-chooser-content" *ngIf="showColumnChooser" [ngClass]="{'np-column-chooser-open':_isOpenColumnChooser}">
                <div class="txt-right">
                    <button type="button" class="np-icon-button" title="Reset all" (click)="_onResetColumns()">
                        <svg class="np-icon" viewBox="0 0 24 24">
                            <path fill="currentcolor" d="M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z" />
                            <path d="M0 0h24v24H0z" fill="none" /></svg>
                    </button>
                    <button type="button" class="np-icon-button" title="Close" (click)="_isOpenColumnChooser = false">
                        <svg class="np-icon" viewBox="0 0 24 24">
                            <path fill="currentcolor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                            <path d="M0 0h24v24H0z" fill="none" /></svg>
                    </button>
                </div>
                <div class="np-drag-list"  cdkDropList [cdkDropListDisabled]="!allowColumnReorder" (cdkDropListDropped)="_dropColumn($event)">
                    <div class="np-drag-box" *ngFor="let column of _columns; let j = index" cdkDrag cdkDragLockAxis="y" cdkDragBoundary=".np-drag-list">                        
                        <label>
                            <input type="checkbox" [checked]="column.visible" (change)="_onColumnChoosing(column)">
                            <span>{{column.getCaption()}}</span>
                        </label>
                        <div class="np-drag-placeholder" *cdkDragPlaceholder></div>
                        <div class="np-drag-handle" cdkDragHandle *ngIf="allowColumnReorder">
                            <svg class="np-icon" viewBox="0 0 24 24">
                                <path fill="currentcolor" d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z" />
                                <path d="M0 0h24v24H0z" fill="none" />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="np-toolbar-item" *ngIf="_isFilterAvailable">
            <button class="np-icon-button" title="Toggle filters" (click)="showFilters = !showFilters">
                <svg *ngIf="!showFilters" class="np-icon-lg" viewBox="0 0 24 24">
                    <path fill="currentcolor" d="M15,19.88C15.04,20.18 14.94,20.5 14.71,20.71C14.32,21.1 13.69,21.1 13.3,20.71L9.29,16.7C9.06,16.47 8.96,16.16 9,15.87V10.75L4.21,4.62C3.87,4.19 3.95,3.56 4.38,3.22C4.57,3.08 4.78,3 5,3V3H19V3C19.22,3 19.43,3.08 19.62,3.22C20.05,3.56 20.13,4.19 19.79,4.62L15,10.75V19.88M7.04,5L11,10.06V15.58L13,17.58V10.05L16.96,5H7.04Z" />
                </svg>            
                <svg *ngIf="showFilters" class="np-icon-lg" viewBox="0 0 24 24">
                    <path fill="currentcolor" d="M14.73,20.83L17.58,18L14.73,15.17L16.15,13.76L19,16.57L21.8,13.76L23.22,15.17L20.41,18L23.22,20.83L21.8,22.24L19,19.4L16.15,22.24L14.73,20.83M13,19.88C13.04,20.18 12.94,20.5 12.71,20.71C12.32,21.1 11.69,21.1 11.3,20.71L7.29,16.7C7.06,16.47 6.96,16.16 7,15.87V10.75L2.21,4.62C1.87,4.19 1.95,3.56 2.38,3.22C2.57,3.08 2.78,3 3,3V3H17V3C17.22,3 17.43,3.08 17.62,3.22C18.05,3.56 18.13,4.19 17.79,4.62L13,10.75V19.88M5.04,5L9,10.06V15.58L11,17.58V10.05L14.96,5H5.04Z" />
                </svg>   
            </button>         
        </div>
        <div class="np-toolbar-item" *ngIf="allowExportToCSV">
            <button type="button" title="Export to CSV" class="np-icon-button" (click)="_exportAsXls()">                
                <svg class="np-icon-lg" viewBox="0 0 50 50"><path fill="currentColor" d="M 28.875 0 C 28.855469 0.0078125 28.832031 0.0195313 28.8125 0.03125 L 0.8125 5.34375 C 0.335938 5.433594 -0.0078125 5.855469 0 6.34375 L 0 43.65625 C -0.0078125 44.144531 0.335938 44.566406 0.8125 44.65625 L 28.8125 49.96875 C 29.101563 50.023438 29.402344 49.949219 29.632813 49.761719 C 29.859375 49.574219 29.996094 49.296875 30 49 L 30 44 L 47 44 C 48.09375 44 49 43.09375 49 42 L 49 8 C 49 6.90625 48.09375 6 47 6 L 30 6 L 30 1 C 30.003906 0.710938 29.878906 0.4375 29.664063 0.246094 C 29.449219 0.0546875 29.160156 -0.0351563 28.875 0 Z M 28 2.1875 L 28 6.53125 C 27.867188 6.808594 27.867188 7.128906 28 7.40625 L 28 42.8125 C 27.972656 42.945313 27.972656 43.085938 28 43.21875 L 28 47.8125 L 2 42.84375 L 2 7.15625 Z M 30 8 L 47 8 L 47 42 L 30 42 L 30 37 L 34 37 L 34 35 L 30 35 L 30 29 L 34 29 L 34 27 L 30 27 L 30 22 L 34 22 L 34 20 L 30 20 L 30 15 L 34 15 L 34 13 L 30 13 Z M 36 13 L 36 15 L 44 15 L 44 13 Z M 6.6875 15.6875 L 12.15625 25.03125 L 6.1875 34.375 L 11.1875 34.375 L 14.4375 28.34375 C 14.664063 27.761719 14.8125 27.316406 14.875 27.03125 L 14.90625 27.03125 C 15.035156 27.640625 15.160156 28.054688 15.28125 28.28125 L 18.53125 34.375 L 23.5 34.375 L 17.75 24.9375 L 23.34375 15.6875 L 18.65625 15.6875 L 15.6875 21.21875 C 15.402344 21.941406 15.199219 22.511719 15.09375 22.875 L 15.0625 22.875 C 14.898438 22.265625 14.710938 21.722656 14.5 21.28125 L 11.8125 15.6875 Z M 36 20 L 36 22 L 44 22 L 44 20 Z M 36 27 L 36 29 L 44 29 L 44 27 Z M 36 35 L 36 37 L 44 37 L 44 35 Z"/></svg>
            </button>
        </div>
        <div class="np-toolbar-item align-right hidden-xs np-state-manager" *ngIf="enableStateStoring">
            <div>
                <select class="grid-control" [(ngModel)]="_currentStateName" (change)="_loadState()">
                    <option value="">Select...</option>
                    <option *ngFor="let state of _stateList" [ngValue]="state.name">{{state.name}}</option>
                </select>
            </div>
            <div *ngIf="_currentStateName.length > 0">
                <button type="button" class="np-icon-button" title="Save state" (click)="_saveState()">
                    <svg class="np-icon-lg" viewBox="0 0 24 24">
                        <path fill="none" d="M0 0h24v24H0V0z" />
                        <path fill="currentcolor"
                            d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6z" />
                    </svg>
                </button>
            </div>
            <div *ngIf="_currentStateName.length > 0">
                <button type="button" class="np-icon-button" title="Delete state" (click)="_deleteState()">
                    <svg class="np-icon-lg" viewBox="0 0 24 24">
                        <path fill="none" d="M0 0h24v24H0V0z" />
                        <path fill="currentcolor"
                            d="M14.12 10.47L12 12.59l-2.13-2.12-1.41 1.41L10.59 14l-2.12 2.12 1.41 1.41L12 15.41l2.12 2.12 1.41-1.41L13.41 14l2.12-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4zM6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9z" />
                    </svg>
                </button>
            </div>
            <div>
                <button type="button" class="np-icon-button" title="Add state" (click)="_addState()">
                    <svg class="np-icon-lg" viewBox="0 0 24 24">
                        <path fill="none" d="M0 0h24v24H0V0z" />
                        <path fill="currentcolor"
                            d="M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-8-2h2v-4h4v-2h-4V7h-2v4H7v2h4z" />
                    </svg>
                </button>
            </div>
        </div>
    </div>
    <div [style.max-height.px]="height - (title && title.length > 0 ? 25 : 0) - (showToolBar ? 40 : 0) - 42" class="np-grid-container">
        <table class="np-grid-table">
            <colgroup>
                <col style="width: 30px;" *ngIf="_enableMasterChild">
                <col style="width: 30px;" *ngIf="singleRowSelectEnable || multiRowSelectEnable">
                <col *ngFor="let column of _visibleColumns" [style.width.px]="column.width">
            </colgroup>
            <thead>
                <tr class="np-grid-header-row">
                    <th *ngIf="_enableMasterChild" [ngClass]="{'np-sticky-header' : isStickyHeader}"></th>
                    <th *ngIf="singleRowSelectEnable || multiRowSelectEnable" [ngClass]="{'np-sticky-header' : isStickyHeader}">
                        <input class="row-selection-input" type="checkbox" *ngIf="multiRowSelectEnable" title="Select/Unselect all" (change)="_onSelectAll($event)" [(ngModel)]="_isAllSelected">
                    </th>
                    <th *ngFor="let column of _visibleColumns; let j = index" [ngClass]="{'np-sticky-header' : isStickyHeader,'hidden': column.visible == false}">
                        <span [innerHTML]="column.getCaption()" (click)="_onSort(column)" [ngClass]="{'cursor-pointer': column.sortEnable}" class="np-grid-header"></span>
                        <button class="np-icon-button" type="button" *ngIf="column.sortDirection != null" (click)="_onSort(column)">
                            <svg class="np-icon" viewBox="0 0 24 24"
                                *ngIf="column.sortDirection == _sortDirections.Ascending">
                                <path fill="none" d="M0 0h24v24H0V0z" />
                                <path fill="currentcolor" d="M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z" /></svg>
                            <svg class="np-icon" viewBox="0 0 24 24"
                                *ngIf="column.sortDirection == _sortDirections.Descending">
                                <path fill="none" d="M0 0h24v24H0V0z" />
                                <path fill="currentcolor" d="M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z" /></svg>
                        </button>                        
                        <div class="np-resizable-handle" *ngIf="allowColumnResize" cdkDrag cdkDragLockAxis="x" [cdkDragDisabled]="!allowColumnResize" (cdkDragEnded)="_resizeColumn($event, column)"></div>
                    </th>
                </tr>
                <tr class="np-grid-header-filter" *ngIf="_isFilterAvailable && showFilters">
                    <th *ngIf="_enableMasterChild"></th>
                    <th *ngIf="singleRowSelectEnable || multiRowSelectEnable"> </th>
                    <th *ngFor="let column of _visibleColumns; let j = index" [ngClass]="{'hidden': column.visible == false}">
                        <div *ngIf="column.filterEnable">
                            <div class="filter-type">
                                <select class="grid-control" [(ngModel)]="column.filterOperator" (change)="_onFilter(column, false)">
                                    <option [value]="undefined" disabled hidden>Select...</option>
                                    <option *ngFor="let filterOperator of _filtersList | filterTypesPipe: column.dataType"
                                        [ngValue]="filterOperator.name" [innerText]="filterOperator.text"></option>
                                </select>                                
                            </div>
                            <div>
                                <input type="text" class="grid-control" *ngIf="column.dataType == _dataTypes.String" [(ngModel)]="column.filterValue" (change)="_onFilter(column, false)" placeholder="Search...">
                                <input type="number" class="grid-control" *ngIf="column.dataType == _dataTypes.Number" [(ngModel)]="column.filterValue" (change)="_onFilter(column, false)" placeholder="Search...">
                                <input type="date" class="grid-control" *ngIf="column.dataType == _dataTypes.Date" [(ngModel)]="column.filterValue" (change)="_onFilter(column, false)" placeholder="Search...">
                                <select class="grid-control" *ngIf="column.dataType == _dataTypes.Boolean" [(ngModel)]="column.filterValue" (change)="_onFilter(column, false)">
                                    <option [value]="undefined" disabled hidden>Select...</option>
                                    <option [value]="true">True</option>
                                    <option [value]="false">False</option>
                                </select>
                            </div>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <ng-container *ngFor="let data of _currentViewData; let  i = index">
                    <tr id="row_{{i}}" (click)="_rowClick($event,data)" [ngClass]="{'np-row-selected': _isSelected(data[_key])}">
                        <td *ngIf="_enableMasterChild" class="txt-center">
                            <button class="np-icon-button" type="button" *ngIf="!_isOpenChild(data[_key])" (click)="_openMasterChild(data[_key])">
                                <svg class="np-icon" viewBox="0 0 24 24">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" fill="currentcolor" />
                                    <path d="M0 0h24v24H0z" fill="none" /></svg>
                            </button>
                            <button class="np-icon-button" type="button" *ngIf="_isOpenChild(data[_key])" (click)="_openMasterChild(data[_key])">
                                <svg class="np-icon" viewBox="0 0 24 24">
                                    <path d="M19 13H5v-2h14v2z" fill="currentcolor"/>
                                    <path d="M0 0h24v24H0z" fill="none" /></svg>
                            </button>
                        </td>
                        <td *ngIf="singleRowSelectEnable || multiRowSelectEnable" class="txt-center">
                            <input type="checkbox" [checked]="_isSelected(data[_key])" (change)="_onSelectRow(data[_key],$event)">
                        </td>
                        <td *ngFor="let column of _visibleColumns; let j = index" (click)="_onCellClick($event, column, data)" 
                            [class]="column.styleClass" [ngClass]="{'hidden': column.visible == false, 'txt-right' : column.rightAlignText}">
                            <ng-container *ngIf="!column.cellTemplate; else customTemplate">
                                {{data[column.dataField]}}
                            </ng-container>
                            <ng-template #customTemplate [ngTemplateOutlet]="column.cellTemplate" [ngTemplateOutletContext]="{ row: data }">
                            </ng-template>
                        </td>
                    </tr>
                    <tr id="row_{{i}}_child" *ngIf="_enableMasterChild && _isOpenChild(data[_key])">
                        <td [attr.colspan]="_visibleColumns.length + (singleRowSelectEnable || multiRowSelectEnable ? 1 : 0) + 1">
                            <ng-container *ngTemplateOutlet="masterDetailTemplate;context:{ row: data }">
                            </ng-container>
                        </td>
                    </tr>
                </ng-container>
            </tbody>
        </table>
        <div *ngIf="_currentViewData && _currentViewData.length == 0 && !_showLoader" class="no-data-message">
            {{noDataMessage}}
        </div>
        <div class="np-grid-summary" *ngIf="showSummary">
            <ng-container *ngTemplateOutlet="summaryTemplate;context:{ summary: _summaryData }">
            </ng-container>
        </div>
    </div>
    <div *ngIf="_pager.pages && _pager.pages.length > 0" class="np-pagination">
        <div>
            <button type="button" class="np-icon-button" title="First page" [disabled]="_pager.currentPage === 1" (click)="_getCurrentViewData(1)">
                        <svg class="np-icon-lg" viewBox="0 0 24 24">
                            <path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z" fill="currentcolor"/>
                            <path d="M0 0h24v24H0z" fill="none" /></svg>
            </button>
        </div>
        <div>
            <button type="button" class="np-icon-button" title="Prev page" [disabled]="_pager.currentPage === 1" (click)="_getCurrentViewData(_pager.currentPage - 1)">
                        <svg class="np-icon-lg" viewBox="0 0 24 24">
                            <path d="M14 7l-5 5 5 5V7z" fill="currentcolor"/>
                            <path fill="none" d="M24 0v24H0V0h24z" /></svg>
            </button>
        </div>
        <div>
            <input type="number" class="grid-control " [(ngModel)]="_pager.currentPage" (change)="_getCurrentViewData(_pager.currentPage)"> / {{_pager.totalPages}}
        </div>
        <div>
            <button type="button" title="Next page" class="np-icon-button" [disabled]="_pager.currentPage === _pager.totalPages" (click)="_getCurrentViewData(_pager.currentPage + 1)">
                        <svg class="np-icon-lg" viewBox="0 0 24 24">
                            <path d="M10 17l5-5-5-5v10z" fill="currentcolor" />
                            <path fill="none" d="M0 24V0h24v24H0z" /></svg>
            </button>
        </div>
        <div>
            <button type="button" title="Last page" class="np-icon-button" [disabled]="_pager.currentPage === _pager.totalPages" (click)="_getCurrentViewData(_pager.totalPages)">
                        <svg class="np-icon-lg" viewBox="0 0 24 24">
                            <path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z" fill="currentcolor"/>
                            <path d="M0 0h24v24H0z" fill="none" /></svg>
            </button>
        </div>
        <div class="align-right hidden-xs">
            <button type="button" class="np-icon-button" title="Refresh" (click)="_onRefresh()">
                    <svg class="np-icon-lg" viewBox="0 0 24 24">
                        <path fill="currentcolor"
                            d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" />
                        <path d="M0 0h24v24H0z" fill="none" /></svg>
            </button>
        </div>
        <div class="align-right hidden-xs">
            <input type="number" class="grid-control" [(ngModel)]="_pager.pageSize" (change)="_onPageSizeChange()"> items per page / {{_pager.startIndex >= 0 ? _pager.startIndex + 1 : 0}} - {{_pager.endIndex + 1}} of {{_pager.totalItems}} items
        </div>
    </div>
</div>